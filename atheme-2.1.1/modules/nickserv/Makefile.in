# Copyright (c) 2003-2004 E. Will et al.
# Rights to this code are documented in doc/LICENSE.
#
# This file contains build instructions.
#
# $Id: Makefile.in 7293 2006-11-25 22:13:28Z jilles $
#

CC		= @CC@
RM		= @RM@
MV		= @MV@
CP		= @CP@
INSTALL		= @INSTALL@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
datadir		= @datadir@
sysconfdir	= @sysconfdir@
libdir		= @libdir@
sbindir		= @sbindir@
localstatedir	= @localstatedir@
DOCDIR		= @DOCDIR@
MODDIR		= @MODDIR@
SHAREDIR	= @SHAREDIR@
BIN		= atheme@EXEEXT@
MKDEP		= @MKDEP@ -DPREFIX=\"@prefix@\" -I../../include @PGINC@
PICFLAGS	= @PICFLAGS@
CFLAGS		= @CFLAGS@ -I../../include -I../../libatheme @PGINC@

LIBS		= @LIBS@ @PQLIB@
LDFLAGS		= @LDFLAGS@
CPPFLAGS	= @CPPFLAGS@

default: all

BASE_SRCS = 		\
	main.c		\
	access.c	\
	drop.c		\
	enforce.c	\
	freeze.c	\
	ghost.c		\
	group.c		\
	help.c		\
	hold.c		\
	identify.c	\
	info.c		\
	list.c		\
	listchans.c	\
	listmail.c	\
	logout.c	\
	mark.c		\
	register.c	\
	resetpass.c	\
	return.c	\
	sendpass.c	\
	set.c		\
	status.c	\
	taxonomy.c	\
	verify.c	\
	vhost.c
	
SRCS = ${BASE_SRCS}

OBJS = ${SRCS:.c=.so} login.so

all: modules

build: all

install: build
	${INSTALL} -d $(DESTDIR)${MODDIR}/modules/nickserv
	${INSTALL} -m 755 *.so $(DESTDIR)${MODDIR}/modules/nickserv

modules: $(OBJS)

.SUFFIXES: .so

.c.so:
	${CC} ${PICFLAGS} ${CPPFLAGS} ${CFLAGS} $< -o $@

login.so: identify.c
	${CC} ${PICFLAGS} ${CPPFLAGS} ${CFLAGS} -DNICKSERV_LOGIN identify.c -o login.so

.PHONY: depend clean distclean
# This sed command sucks but I don't know a better way -- jilles
depend:
	${MKDEP} ${PICFLAGS} ${CPPFLAGS} ${CFLAGS} ${BASE_SRCS} | sed -e 's/\.o:/.so:/' > .depend

clean:
	${RM} -f *.so

distclean: clean
	${RM} -f Makefile version.c.last

include .depend

